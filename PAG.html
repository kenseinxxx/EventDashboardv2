<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EIOC 2025 — Program at a Glance</title>
  <style>
    :root{
      --bg:#f7f8fb; --card:#ffffff; --text:#12141a; --muted:#5b6270; --ring:#e6e8ef;
      --good:#16a34a; --warn:#f59e0b; --bad:#dc2626;
      --c-oncologist:#1f77b4; --c-physicians:#ff7f0e; --c-onco-nurses:#2ca02c; --c-nurses:#d62728; --c-allied:#9467bd; --c-surgeon:#bd1184; --c-academia:#055120;
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text); padding:24px}
    header{display:flex;flex-wrap:wrap;align-items:center;gap:12px;justify-content:space-between;margin:0 0 20px}
    h1{font-size:clamp(20px,3vw,28px);margin:0}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .button{appearance:none;border:1px solid var(--ring);background:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600;box-shadow:0 1px 0 rgba(10,10,10,.02)}
    .button.primary{background:#111827;color:#fff;border-color:#111827}
    .denom-select{padding:10px 12px;border-radius:10px;border:1px solid var(--ring);background:#fff;font-weight:600}

    /* ROW LAYOUT (keeps your exact per-row counts) */
    .row{display:flex;gap:20px;justify-content:space-between;margin-bottom:20px}
    .row.three .session{width:32%}
    .row.two .session{width:49%}

    .session{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:18px 16px;box-shadow:0 2px 10px rgba(0,0,0,.04)}
    .session h3{margin:0 0 6px;font-size:18px;color:#0f766e}
    .hall-name{font-size:13px;color:var(--muted);margin:0 0 10px;text-align:left}
    .meta{display:flex;flex-wrap:wrap;gap:10px;font-size:13px;color:#334155;margin-bottom:10px}
    .meta b{color:#0f172a}

    .usage{display:flex;align-items:center;gap:10px;margin:4px 0 14px}
    .usage-bar{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;flex:1;border:1px solid #d1d5db}
    .usage-fill{height:100%;width:0%;background:var(--good);transition:width .4s ease, background-color .2s ease}
    .usage-text{font-size:12px;color:#334155;min-width:110px;text-align:right}

    .category-label{font-size:13px;margin:8px 0 6px;color:#111827}
    .bar-container{width:100%;background:#eef2f7;border:1px solid #dde4ee;border-radius:8px;overflow:hidden}
    .bar{height:22px;display:flex;align-items:center;justify-content:flex-end;color:#fff;font-weight:700;padding-right:8px;line-height:1;min-width:2.2rem}
    .bar.oncologist{background:var(--c-oncologist)}
    .bar.physicians{background:var(--c-physicians)}
    .bar.onco-nurses{background:var(--c-onco-nurses)}
    .bar.nurses{background:var(--c-nurses)}
    .bar.allied{background:var(--c-allied)}
    .bar.surgeon{background:var(--c-surgeon)}
    .bar.academia{background:var(--c-academia)}

    .legend{display:flex;flex-wrap:wrap;gap:10px;margin:6px 0 0}
    .chip{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#334155;border:1px solid var(--ring);border-radius:999px;padding:6px 10px;background:#fff}
    .dot{width:10px;height:10px;border-radius:999px}
    .dot.oncologist{background:var(--c-oncologist)}
    .dot.physicians{background:var(--c-physicians)}
    .dot.onco-nurses{background:var(--c-onco-nurses)}
    .dot.nurses{background:var(--c-nurses)}
    .dot.allied{background:var(--c-allied)}
    .dot.surgeon{background:var(--c-surgeon)}
    .dot.academia{background:var(--c-academia)}

    .editing .bar{outline:2px dashed rgba(99,102,241,.35)}
    .footer-note{margin-top:14px;font-size:12px;color:#64748b}

    .back{margin-bottom:16px}
  </style>
</head>
<body>
  <button class="button back" id="backBtn">← Back</button>

  <header>
    <h1>EIOC 2025 · Program at a Glance</h1>
    <div class="controls">
      <label>Relative to:
        <select id="denominatorSelect" class="denom-select">
          <option value="total" selected>Total registrations</option>
          <option value="unique">Unique</option>
        </select>
      </label>
      <button id="editBtn" class="button">Edit</button>
      <button id="saveBtn" class="button primary" style="display:none">Save</button>
    </div>
  </header>

  <h2 style="margin:6px 0 12px;font-size:16px;color:#334155">Parallel Sessions — Day 1</h2>

  <!-- DAY 1: keep 3 on first row, 2 on second row -->
  <section id="day1">
    <div class="row three">
      <!-- GI Cancer -->
      <article class="session" data-session-id="gi_cancer">
        <h3>GI Cancer</h3>
        <div class="hall-name"><strong>Hall: AL RAS 2</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">500</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>

        <div class="category-label">Oncology Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncology_specialist" data-count="0">0</div></div>
        <div class="category-label">Head &amp; Neck Oncologist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="head_neck_oncologist" data-count="0">0</div></div>
        <div class="category-label">Physician</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physicians" data-count="0">0</div></div>
        <div class="category-label">Dietician</div>
        <div class="bar-container"><div class="bar allied" data-cat="dietician" data-count="0">0</div></div>
        <div class="category-label">Pediatric Specialist</div>
        <div class="bar-container"><div class="bar allied" data-cat="pediatric_specialist" data-count="0">0</div></div>
        <div class="category-label">Anesthesiologist</div>
        <div class="bar-container"><div class="bar allied" data-cat="anesthesiologist" data-count="0">0</div></div>
        <div class="category-label">Surgical Oncologist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="surgical_oncologist" data-count="0">0</div></div>
        <div class="category-label">Surgical Specialist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="surgical_specialist" data-count="0">0</div></div>
        <div class="category-label">General Surgeon</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="general_surgeon" data-count="0">0</div></div>
        <div class="category-label">Urologist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="urologist" data-count="0">0</div></div>
        <div class="category-label">Radiology Specialist</div>
        <div class="bar-container"><div class="bar allied" data-cat="radiology_specialist" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Oncology Nurses</div>
        <div class="bar-container"><div class="bar onco-nurses" data-cat="oncology_nurses" data-count="0">0</div></div>
        <div class="category-label">Others &amp; Allied HCP</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
        <div class="category-label">Academia</div>
        <div class="bar-container"><div class="bar academia" data-cat="academia" data-count="0">0</div></div>
        <div class="legend">
          <span class="chip"><span class="dot oncologist"></span> Oncologist</span>
          <span class="chip"><span class="dot physicians"></span> Physicians</span>
          <span class="chip"><span class="dot nurses"></span> Nurses</span>
          <span class="chip"><span class="dot onco-nurses"></span> Onco Nurses</span>
          <span class="chip"><span class="dot surgeon"></span> Surgeon</span>
          <span class="chip"><span class="dot allied"></span> Allied</span>
          <span class="chip"><span class="dot academia"></span> Academia</span>
        </div>
      </article>

      <!-- Head & Neck Session -->
      <article class="session" data-session-id="head_neck">
        <h3>Head &amp; Neck Session</h3>
        <div class="hall-name"><strong>Hall: AL RAS 3</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">500</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>

        <div class="category-label">Oncology Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncology_specialist" data-count="0">0</div></div>
        <div class="category-label">Head &amp; Neck Specialist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="head_neck_specialist" data-count="0">0</div></div>
        <div class="category-label">Physicians</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physicians" data-count="0">0</div></div>
        <div class="category-label">Onco Nurses</div>
        <div class="bar-container"><div class="bar onco-nurses" data-cat="onco_nurses" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Other (Allied HCP)</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
        <div class="category-label">Academia</div>
        <div class="bar-container"><div class="bar academia" data-cat="academia" data-count="0">0</div></div>
        <div class="legend">
          <span class="chip"><span class="dot oncologist"></span> Oncologist</span>
          <span class="chip"><span class="dot physicians"></span> Physicians</span>
          <span class="chip"><span class="dot nurses"></span> Nurses</span>
          <span class="chip"><span class="dot onco-nurses"></span> Onco Nurses</span>
          <span class="chip"><span class="dot surgeon"></span> Surgeon</span>
          <span class="chip"><span class="dot allied"></span> Allied</span>
          <span class="chip"><span class="dot academia"></span> Academia</span>
        </div>
      </article>

      <!-- Oncology Nutrition -->
      <article class="session" data-session-id="oncology_nutrition">
        <h3>Oncology Nutrition</h3>
        <div class="hall-name"><strong>Hall: AMWAJ</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">250</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>

        <div class="category-label">Oncology Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncology_specialist" data-count="0">0</div></div>
        <div class="category-label">Head &amp; Neck Oncologist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="head_neck_oncologist" data-count="0">0</div></div>
        <div class="category-label">Physician</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physician" data-count="0">0</div></div>
        <div class="category-label">Dietician</div>
        <div class="bar-container"><div class="bar allied" data-cat="dietician" data-count="0">0</div></div>
        <div class="category-label">Anesthesiologist</div>
        <div class="bar-container"><div class="bar allied" data-cat="anesthesiologist" data-count="0">0</div></div>
        <div class="category-label">Surgical Oncologist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="surgical_oncologist" data-count="0">0</div></div>
        <div class="category-label">Surgical Specialist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="surgical_specialist" data-count="0">0</div></div>
        <div class="category-label">General Surgeon</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="general_surgeon" data-count="0">0</div></div>
        <div class="category-label">Urologist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="urologist" data-count="0">0</div></div>
        <div class="category-label">Radiology Specialist</div>
        <div class="bar-container"><div class="bar allied" data-cat="radiology_specialist" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Oncology Nurses</div>
        <div class="bar-container"><div class="bar onco-nurses" data-cat="oncology_nurses" data-count="0">0</div></div>
        <div class="category-label">Others &amp; Allied HCP</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
        <div class="category-label">Academia</div>
        <div class="bar-container"><div class="bar academia" data-cat="academia" data-count="0">0</div></div>
        <div class="legend">
          <span class="chip"><span class="dot oncologist"></span> Oncologist</span>
          <span class="chip"><span class="dot physicians"></span> Physicians</span>
          <span class="chip"><span class="dot nurses"></span> Nurses</span>
          <span class="chip"><span class="dot onco-nurses"></span> Onco Nurses</span>
          <span class="chip"><span class="dot surgeon"></span> Surgeon</span>
          <span class="chip"><span class="dot allied"></span> Allied</span>
          <span class="chip"><span class="dot academia"></span> Academia</span>
        </div>
      </article>
    </div>

    <div class="row two">
      <!-- Immuno Oncology -->
      <article class="session" data-session-id="immuno_oncology">
        <h3>Immuno Oncology</h3>
        <div class="hall-name"><strong>Hall: AL RAS 2</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">500</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>
        <!-- bars will be filled from JSON; provide a few common keys -->
        <div class="category-label">Oncology Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncology_specialist" data-count="0">0</div></div>
        <div class="category-label">Physician</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physicians" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="legend">
          <span class="chip"><span class="dot oncologist"></span> Oncologist</span>
          <span class="chip"><span class="dot physicians"></span> Physicians</span>
          <span class="chip"><span class="dot nurses"></span> Nurses</span>
        </div>
      </article>

      <!-- Breast Imaging / Surgical Session -->
      <article class="session" data-session-id="breast_imaging_surgical">
        <h3>Breast Imaging / Breast Surgical Session</h3>
        <div class="hall-name"><strong>Hall: AMWAJ</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">250</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>
        <div class="category-label">Oncology Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncology_specialist" data-count="0">0</div></div>
        <div class="category-label">Breast Specialist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="breast_specialist" data-count="0">0</div></div>
        <div class="category-label">Physicians</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physicians" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Other (Allied HCP)</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
        <div class="category-label">Academia</div>
        <div class="bar-container"><div class="bar academia" data-cat="academia" data-count="0">0</div></div>
        <div class="legend">
          <span class="chip"><span class="dot oncologist"></span> Oncologist</span>
          <span class="chip"><span class="dot physicians"></span> Physicians</span>
          <span class="chip"><span class="dot nurses"></span> Nurses</span>
          <span class="chip"><span class="dot surgeon"></span> Surgeon</span>
          <span class="chip"><span class="dot allied"></span> Allied</span>
          <span class="chip"><span class="dot academia"></span> Academia</span>
        </div>
      </article>
    </div>
  </section>

  <h2 style="margin:22px 0 12px;font-size:16px;color:#334155">Parallel Sessions — Day 2</h2>

  <!-- DAY 2: first row 3, second row 2 -->
  <section id="day2">
    <div class="row three">
      <article class="session" data-session-id="lung_cancer">
        <h3>Lung Cancer</h3>
        <div class="hall-name"><strong>Hall: AL RAS 2</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">500</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>
        <div class="category-label">Oncology Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncology_specialist" data-count="0">0</div></div>
        <div class="category-label">Lung Specialist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="lung_specialist" data-count="0">0</div></div>
        <div class="category-label">Physicians</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physicians" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Onco Nurses</div>
        <div class="bar-container"><div class="bar onco-nurses" data-cat="onco_nurses" data-count="0">0</div></div>
        <div class="category-label">Other (Allied HCP)</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
        <div class="category-label">Academia</div>
        <div class="bar-container"><div class="bar academia" data-cat="academia" data-count="0">0</div></div>
        <div class="legend">
          <span class="chip"><span class="dot oncologist"></span> Oncologist</span>
          <span class="chip"><span class="dot physicians"></span> Physicians</span>
          <span class="chip"><span class="dot nurses"></span> Nurses</span>
        </div>
      </article>

      <article class="session" data-session-id="breast_cancer">
        <h3>Breast Cancer</h3>
        <div class="hall-name"><strong>Hall: AL RAS 3</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">500</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>
        <div class="category-label">Oncologist Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncologist_specialist" data-count="0">0</div></div>
        <div class="category-label">Breast Specialist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="breast_specialist" data-count="0">0</div></div>
        <div class="category-label">Physicians</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physicians" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Onco Nurses</div>
        <div class="bar-container"><div class="bar onco-nurses" data-cat="onco_nurses" data-count="0">0</div></div>
        <div class="category-label">Other (Allied HCP)</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
        <div class="category-label">Academia</div>
        <div class="bar-container"><div class="bar academia" data-cat="academia" data-count="0">0</div></div>
      </article>

      <article class="session" data-session-id="uro_oncology">
        <h3>Uro Oncology</h3>
        <div class="hall-name"><strong>Hall: AL AMWAJ</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">300</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>
        <div class="category-label">Oncology Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncology_specialist" data-count="0">0</div></div>
        <div class="category-label">Physician</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physician" data-count="0">0</div></div>
        <div class="category-label">Urologist</div>
        <div class="bar-container"><div class="bar surgeon" data-cat="urologist" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Other (Allied HCP)</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
      </article>
    </div>

    <div class="row two">
      <article class="session" data-session-id="oncology_nursing">
        <h3>Oncology Nursing</h3>
        <div class="hall-name"><strong>Hall: AL AMWAJ</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">300</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Oncology Nurses</div>
        <div class="bar-container"><div class="bar onco-nurses" data-cat="oncology_nurses" data-count="0">0</div></div>
        <div class="category-label">Others &amp; Allied Hcp</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
        <div class="category-label">Academia</div>
        <div class="bar-container"><div class="bar academia" data-cat="academia" data-count="0">0</div></div>
      </article>

      <article class="session" data-session-id="palliative_care">
        <h3>Palliative Care</h3>
        <div class="hall-name"><strong>Hall: AL RIMAL</strong></div>
        <div class="meta">
          <span>Capacity: <b class="cap-val">250</b></span>
          <span>· Total Registrations: <b class="total-val">0</b></span>
          <span>· Unique: <b class="unique-val">0</b></span>
        </div>
        <div class="usage"><div class="usage-bar"><div class="usage-fill"></div></div><div class="usage-text"></div></div>
        <div class="category-label">Oncology Specialist</div>
        <div class="bar-container"><div class="bar oncologist" data-cat="oncology_specialist" data-count="0">0</div></div>
        <div class="category-label">Physician</div>
        <div class="bar-container"><div class="bar physicians" data-cat="physicians" data-count="0">0</div></div>
        <div class="category-label">Nurses</div>
        <div class="bar-container"><div class="bar nurses" data-cat="nurses" data-count="0">0</div></div>
        <div class="category-label">Oncology Nurses</div>
        <div class="bar-container"><div class="bar onco-nurses" data-cat="oncology_nurses" data-count="0">0</div></div>
        <div class="category-label">Other (Allied HCP)</div>
        <div class="bar-container"><div class="bar allied" data-cat="allied" data-count="0">0</div></div>
        <div class="category-label">Academia</div>
        <div class="bar-container"><div class="bar academia" data-cat="academia" data-count="0">0</div></div>
      </article>
    </div>
  </section>

  <p class="footer-note">Tip: switch the dropdown to view bars as a percentage of Total registrations vs. Unique attendees. Click <b>Edit</b> to modify counts inline; <b>Save</b> sends updates to your Flask endpoint and writes them into <code>dashboard_data.json</code>.</p>

  <script>
    const DATA_URL = 'dashboard_data.json';
    const SAVE_URL = 'http://127.0.0.1:5000/save-dashboard'; // adjust if needed

    const backBtn = document.getElementById('backBtn');
    const denomSelect = document.getElementById('denominatorSelect');
    const editBtn = document.getElementById('editBtn');
    const saveBtn = document.getElementById('saveBtn');

    let DASH = null; // will hold JSON

    backBtn?.addEventListener('click', () => { window.location.href = 'index.html'; });

    function applyUsage(session){
      const cap = Number(session.querySelector('.cap-val')?.textContent||0);
      const total = Number(session.querySelector('.total-val')?.textContent||0);
      const usageFill = session.querySelector('.usage-fill');
      const usageText = session.querySelector('.usage-text');
      const pct = cap ? Math.round((total/cap)*100) : 0;
      usageFill.style.width = Math.min(100, (cap? (total/cap)*100 : 0)) + '%';
      usageFill.style.backgroundColor = pct < 90 ? getComputedStyle(document.documentElement).getPropertyValue('--good')
        : pct <= 100 ? getComputedStyle(document.documentElement).getPropertyValue('--warn')
        : getComputedStyle(document.documentElement).getPropertyValue('--bad');
      usageText.textContent = `${total} / ${cap} (${pct}%)`;
    }

    function recalcSession(session){
      const denom = denomSelect.value;
      const denomVal = Number((denom==='unique'? session.querySelector('.unique-val') : session.querySelector('.total-val'))?.textContent || 0);
      session.querySelectorAll('.bar').forEach(bar => {
        const count = Number(bar.dataset.count || bar.textContent.trim() || 0);
        const pct = denomVal ? (count/denomVal)*100 : 0;
        bar.style.width = Math.max(pct, 0) + '%';
        bar.title = `${count}${denomVal?` (${pct.toFixed(1)}%)`:''}`;
        bar.textContent = count;
      });
      applyUsage(session);
    }

    function recalcAll(){
      document.querySelectorAll('.session').forEach(recalcSession);
    }

    function hydrateFromJSON(){
      if(!DASH || !DASH.sessions) return;
      document.querySelectorAll('.session').forEach(session => {
        const id = session.dataset.sessionId;
        const info = DASH.sessions[id];
        if(!info) return;
        session.querySelector('.cap-val').textContent = info.capacity ?? 0;
        session.querySelector('.total-val').textContent = info.total ?? 0;
        session.querySelector('.unique-val').textContent = info.unique ?? 0;
        // categories
        Object.entries(info.categories||{}).forEach(([key,val])=>{
          const bar = session.querySelector(`.bar[data-cat="${key}"]`);
          if(bar){ bar.dataset.count = val; bar.textContent = val; }
        });
      });
      recalcAll();
    }

    async function loadJSON(){
      try{
        const res = await fetch(DATA_URL + '?ts=' + Date.now(), {cache:'no-store'});
        DASH = await res.json();
        hydrateFromJSON();
      }catch(e){
        console.error('Failed to load dashboard_data.json', e);
        alert('Could not load dashboard_data.json');
      }
    }

    // Enable inline editing
    editBtn?.addEventListener('click', () => {
      document.body.classList.add('editing');
      saveBtn.style.display='inline-block';
      editBtn.style.display='none';
      document.querySelectorAll('.bar, .total-val, .unique-val, .cap-val').forEach(el=> el.setAttribute('contenteditable','plaintext-only'));
    });

    // Save back to JSON via Flask
    saveBtn?.addEventListener('click', async () => {
      // Read DOM back into DASH
      const sessions = {};
      document.querySelectorAll('.session').forEach(session => {
        const id = session.dataset.sessionId;
        const cap = parseInt(session.querySelector('.cap-val')?.textContent.replace(/[^\d-]/g,'')||'0',10) || 0;
        const total = parseInt(session.querySelector('.total-val')?.textContent.replace(/[^\d-]/g,'')||'0',10) || 0;
        const unique = parseInt(session.querySelector('.unique-val')?.textContent.replace(/[^\d-]/g,'')||'0',10) || 0;
        const categories = {};
        session.querySelectorAll('.bar').forEach(bar => {
          const key = bar.dataset.cat;
          const num = parseInt(String(bar.textContent).replace(/[^\d-]/g,''),10);
          categories[key] = isFinite(num) ? num : 0;
          bar.dataset.count = categories[key];
        });
        sessions[id] = { capacity:cap, total, unique, categories };
      });
      DASH = { sessions };

      // Persist to server
      try{
        const resp = await fetch(SAVE_URL, {
          method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(DASH)
        });
        const out = await resp.json();
        if(out.status === 'success'){
          alert('Dashboard saved successfully.');
        }else{
          alert('Save failed on server. Data stays in memory.');
        }
      }catch(err){
        console.error(err);
        alert('Could not reach save endpoint. Is Flask running?');
      }

      // Exit edit mode and recalc
      document.querySelectorAll('.bar, .total-val, .unique-val, .cap-val').forEach(el=> el.removeAttribute('contenteditable'));
      document.body.classList.remove('editing');
      saveBtn.style.display='none';
      editBtn.style.display='inline-block';
      recalcAll();
    });

    denomSelect?.addEventListener('change', recalcAll);
    loadJSON();
  </script>
</body>
</html>
